let charms = {
    "Wayward Compass": [1, "Whispers its location to the bearer whenever a map is open, allowing wanderers to pinpoint their current location."],
    "Gathering Swarm": [1, "A swarm will follow the bearer and gather up any loose Geo.\n\nUseful for those who can't bear to leave anything behind, no matter how insignificant."],
    "Stalwart Shell": [2, "Builds resilience. When recovering from damage, the bearer will remain invulnerable for longer.\n\nMakes it easier to escape from dangerous situations."],
    "Soul Catcher": [2, "Used by shamans to draw more SOUL from the world around them.\n\nIncreases the amount of SOUL gained when striking an enemy with the nail."],
    "Shaman Stone": [3, "Said to contain the knowledge of past generations of shaman.\n\nIncreases the power of spells, dealing more damage to foes."],
    "Soul Eater": [4, "Forgotten shaman artifact, used to draw SOUL from still-living creatures.\n\nGreatly increases the amount of SOUL gained when striking an enemy with the nail."],
    "Dashmaster": [2, "Bears the likeness of an eccentric bug known only as 'The Dashmaster'.\n\nThe bearer will be able to dash more often as well as dash downwards. Perfect for those who want to move around as quickly as possible."],
    "Sprintmaster": [1, "Bears the likeness of a strange bug known only as 'The Sprintmaster'.\n\nIncreases the running speed of the bearer, allowing them to avoid danger or overtake rivals."],
    "Grubsong": [1, "Contains the gratitude of freed grubs.\n\nGain SOUL when taking damage."],
    "Grubberfly's Elegy": [3, "Contains the gratitude of grubs who will move to the next stage of their lives. Imbues weapons with a holy strength.\n\nWhen the bearer is at full health, they will fire beams of white-hot energy from their nail."],
    "Fragile Heart": [2, "Increases the health of the bearer, allowing them to take more damage.\n\nThis charm is fragile, and will break if its bearer is killed."],
    "Unbreakable Heart": [2, "Increases the health of the bearer, allowing them to take more damage.\n\nThis charm is unbreakable."],
    "Fragile Greed": [2, "Causes the bearer to find more Geo when defeating enemies.\n\nThis charm is fragile, and will break if its bearer is killed."],
    "Unbreakable Greed": [2, "Causes the bearer to find more Geo when defeating enemies.\n\nThis charm is unbreakable."],
    "Fragile Strength": [3, "Strengthens the bearer, increasing the damage they deal to enemies with their nail.\n\nThis charm is fragile, and will break if its bearer is killed."],
    "Unbreakable Strength": [3, "Strengthens the bearer, increasing the damage they deal to enemies with their nail.\n\nThis charm is unbreakable."],
    "Spell Twister": [2, "Reflecting the desires of the Soul Sanctum for mastery over SOUL, it improves the bearer's ability to cast spells.\n\nReduces the SOUL cost of casting spells."],
    "Steady Body": [1, "Keeps its bearer from recoiling backwards when they strike an enemy with a nail.\n\nAllows one to stay steady and keep attacking."],
    "Heavy Blow": [2, "Formed from the nails of fallen warriors.\n\nIncreases the force of the bearer's nail, causing enemies to recoil further when hit."],
    "Quick Slash": [3, "Born from imperfect, discarded nails that have fused together. The nails still long to be wielded.\n\nAllows the bearer to slash much more rapidly with their nail."],
    "Longnail": [2, "Increases the range of the bearer's nail, allowing them to strike foes from further away."],
    "Mark of Pride": [3, "Freely given by the Mantis Tribe to those they respect.\n\nGreatly increases the range of the bearer's nail, allowing them to strike foes from further away."],
    "Fury of the Fallen": [2, "Embodies the fury and heroism that comes upon those who are about to die.\n\nWhen close to death, the bearer's strength will increase."],
    "Thorns of Agony": [1, "Senses the pain of its bearer and lashes out at the world around them.\n\nWhen taking damage, sprout thorny vines that damage nearby foes."],
    "Baldur Shell": [2, "Protects its bearer with a hard shell while focusing SOUL.\n\nThe shell is not indestructible and will shatter if it absorbs too much damage."],
    "Flukenest": [3, "Living charm born in the gut of a Flukemarm.\n\nTransforms the Vengeful Spirit spell into a horde of volatile baby flukes."],
    "Defender's Crest": [1, "Unique charm bestowed by the King of Hallownest to his most loyal knight. Scratched and dirty, but still cared for.\n\nCauses the bearer to emit a heroic odour."],
    "Glowing Womb": [2, "Drains the SOUL of its bearer and uses it to birth hatchlings.\n\nThe hatchlings have no desire to eat or live, and will sacrifice themselves to protect their parent."],
    "Quick Focus": [3, "A charm containing a crystal lens.\n\nIncreases the speed of focusing SOUL, allowing the bearer to heal damage faster."],
    "Deep Focus": [4, "Naturally formed within a crystal over a long period. Draws in SOUL from the surrounding air.\n\nThe bearer will focus SOUL at a slower rate, but the healing effect will double."],
    "Lifeblood Heart": [2, "Contains a living core that seeps precious lifeblood.\n\nWhen resting, the bearer will gain a coating of lifeblood that protects from a modest amount of damage."],
    "Lifeblood Core": [3, "Contains a living core that bleeds precious lifeblood.\n\nWhen resting, the bearer will gain a coating of lifeblood that protects from a large amount of damage."],
    "Joni's Blessing": [4, "Blessed by Joni, the kindly heretic. Transfigures vital fluids into blue lifeblood.\n\nThe bearer will have a healthier shell and can take more damage, but they will not be able to heal themselves by focusing SOUL."],
    "Hiveblood": [4, "Golden nugget of the Hive's precious hardened nectar.\n\nHeals the bearer's wounds over time, allowing them to regain health without focusing SOUL."],
    "Spore Shroom": [1, "Composed of living fungal matter. Scatters spores when exposed to SOUL.\n\nWhen focusing SOUL, emit a spore cloud that slowly damages enemies"],
    "Sharp Shadow": [2, "Contains a forbidden spell that transforms shadows into deadly weapons.\n\nWhen using Shadow Dash, the bearer's body will sharpen and damage enemies."],
    "Shape of Unn": [2, "Reveals the form of Unn within the bearer.\n\nWhile focusing SOUL, the bearer will take on a new shape and can move freely to avoid enemies."],
    "Nailmaster's Glory": [1, "Contains the passion, skill and regrets of a Nailmaster.\n\nIncreases the bearer's mastery of Nail Arts, allowing them to focus their power faster and unleash arts sooner."],
    "Weaversong": [2, "Silken charm containing a song of farewell, left by the Weavers who departed Hallownest for their old home.\n\nSummons weaverlings to give the lonely bearer some companionship and protection."],
    "Dream Wielder": [1, "Transient charm created for those who wield the Dream Nail and collect Essence.\n\nAllows the bearer to charge the Dream Nail faster and collect more SOUL when striking foes."],
    "Dreamshield": [3, "Defensive charm once wielded by a tribe that could shape dreams.\n\nConjures a shield that follows the bearer and attempts to protect them."],
    "Grimmchild": [2, "Worn by those who take part in the Grimm Troupe's Ritual.\n\nThe bearer must seek the Grimmkin and collect their flames. Uncollected flames will appear on the bearer's map."],
    "Carefree Melody": [3, "Token commemorating the start of a friendship.\n\nContains a song of protection that may defend the bearer from damage."],
    "Kingsoul": [5, "Holy charm symbolising a union between higher beings. The bearer will slowly absorb the limitless SOUL contained within.\n\nOpens the way to a birthplace."],
    "Void Heart": [0, "An emptiness that was hidden within, now unconstrained. Unifies the void under the bearer's will.\n\nThis charm is a part of its bearer and can not be unequipped."],
};

function fileToName(file) {
    return file.replace("assets/", '').replace(".png", '').replaceAll('_', ' ');
}

function selectCharm(file) {
    let name = fileToName(file);

    document.getElementById("name").innerText = name;
    document.getElementById("symbol").src = file;
    document.getElementById("desc").innerText = charms[name][1];

    let cost = document.getElementById("cost");
    cost.innerHTML = '';
    if (charms[name][0] > 0) {
        cost.innerHTML += "<p>Cost</p>";
    }
    for (let x = 0; x < charms[name][0]; ++x) {
        cost.innerHTML += "<div><img src=\"assets/HK_Notch.png\"></div>";
    }
}

selectCharm("assets/Wayward_Compass.png")

let totalCost = 0;

function updateNotches() {
    document.getElementById("overcharmed").style.opacity = "0%";
    for (let x = 0; x < 11; ++x) {
        document.getElementById("notch_list").children.item(x).style.opacity = "33%";
    }
    for (let x = 11; x < 14; ++x) {
        document.getElementById("notch_list").children.item(x).style.opacity = "0%";
    }
    for (let x = 0; x < totalCost; ++x) {
        document.getElementById("notch_list").children.item(x).style.opacity = "100%";
    }
    for (let x = 0; x < totalCost; ++x) {
        document.getElementById("notch_list").children.item(x).style.opacity = "100%";
    }
    if (totalCost > 11) {
        document.getElementById("overcharmed").style.opacity = "100%";
        document.getElementById("equipped").style.setProperty("--background-image", "url(\"assets/Overcharm.png\")");
    }
}

document.getElementById("charms").addEventListener("click", function (e) {
    if (e.target.tagName === "IMG") {
        let src = e.target.getAttribute("src");
        selectCharm(src);

        if (totalCost < 11 && !e.target.classList.contains("equipped")) {
            e.target.classList.add("equipped");

            document.getElementById("equipped").innerHTML += `<div><img class="charm" src="${src}"></div>`;
            totalCost += charms[fileToName(src)][0];
            updateNotches();
        }
    }
});

document.getElementById("equipped").addEventListener("click", function (e) {
    if (e.target.tagName === "IMG") {
        let src = e.target.getAttribute("src");

        for (let x = 0; x < 40; ++x) {
            let img = document.getElementById("charms").children.item(x).firstChild;

            if (img.getAttribute("src") == src) {
                e.target.outerHTML = '';
                totalCost -= charms[fileToName(src)][0];
                updateNotches();
                img.classList.remove("equipped");
            }
        }
    }
});

function switchCharm(e, a, b) {
    let src = e.target.getAttribute("src");
    if (src === a) {
        e.target.src = b;
        selectCharm(e.target.getAttribute("src"));
    } else if (src === b) {
        e.target.src = a;
        selectCharm(e.target.getAttribute("src"));
    }
}

document.getElementById("heart").addEventListener("contextmenu", function (e) {
    switchCharm(e, "assets/Fragile_Heart.png", "assets/Unbreakable_Heart.png")
});

document.getElementById("greed").addEventListener("contextmenu", function (e) {
    switchCharm(e, "assets/Fragile_Greed.png", "assets/Unbreakable_Greed.png")
});

document.getElementById("strength").addEventListener("contextmenu", function (e) {
    switchCharm(e, "assets/Fragile_Strength.png", "assets/Unbreakable_Strength.png")
});

document.getElementById("grimm_charm").addEventListener("contextmenu", function (e) {
    switchCharm(e, "assets/Carefree_Melody.png", "assets/Grimmchild.png")
});

document.getElementById("useless_charm").addEventListener("contextmenu", function (e) {
    let a = "assets/Kingsoul.png";
    let b = "assets/Void_Heart.png"

    let src = e.target.getAttribute("src");
    if (src === a) {
        e.target.src = b;
        selectCharm(e.target.getAttribute("src"));
        document.getElementById("void_heart").style.opacity = "100%";
    } else if (src === b) {
        e.target.src = a;
        selectCharm(e.target.getAttribute("src"));
        document.getElementById("void_heart").style.opacity = "0%";
    }
});